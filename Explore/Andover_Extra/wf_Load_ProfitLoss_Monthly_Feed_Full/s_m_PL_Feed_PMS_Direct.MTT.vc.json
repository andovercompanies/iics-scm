{
  "name" : "s_m_PL_Feed_PMS_Direct",
  "description" : "Session pushed from PC to ICS : s_m_PL_Feed_PMS_Direct",
  "runtimeEnvironmentId" : "@jRYfI6mJ60tdJACgcoBhOB",
  "runtimeEnvironmentName" : "sag_aws_linux",
  "maxLogs" : 10,
  "parameters" : [
    {
      "name" : "$SQ_ProfitLoss_Monthly_Base$",
      "type" : "EXTENDED_SOURCE",
      "label" : "DBConnection_Src",
      "uiProperties" : {
        "cnxtype" : "Amazon Redshift v2",
        "connectionParameterized" : "true",
        "paramName" : "DBConnection_Src",
        "paramType-mapping" : "Connection",
        "logcnx" : "DBConnection_Src",
        "isSelectDistinct" : "false",
        "isMsrcFilterParameterized" : "false",
        "isMsrcSortParameterized" : "false",
        "objectParameterized" : "false",
        "visible" : "false",
        "originalPath" : "SQ_ProfitLoss_Monthly_Base"
      },
      "sourceConnectionId" : "@6Uao049gWFIeOw6WPSkjsu",
      "connectionName" : "redshift_nonprod_andover_dw_dev",
      "newFlatFile" : false,
      "newObject" : false,
      "showBusinessNames" : true,
      "naturalOrder" : true,
      "truncateTarget" : false,
      "bulkApiDBTarget" : false,
      "customFuncCfg" : { },
      "extendedObject" : {
        "object" : {
          "name" : "dbo/profitloss_monthly_base",
          "label" : "profitloss_monthly_base",
          "metadataUpdated" : false
        },
        "singleMode" : true,
        "objects" : [
          {
            "name" : "dbo/profitloss_monthly_base",
            "label" : "profitloss_monthly_base",
            "metadataUpdated" : false
          }
        ]
      },
      "runtimeAttrs" : {
        "Pre-SQL" : "truncate table dbo.profitloss_monthly_base; \ntruncate table  dbo.profitloss_monthly_feed;",
        "SQL Query" : "SELECT\n    source,\n    companydesc,\n    lobdesc,\n    riskstate,\n    a.annual_statement_line,\n    stateline,\n    directwrittenpremium,\n    cededwrittenpremium,\n    directunearnedpremium,\n    cededunearnedpremium,\n    directlosspaid,\n    directcasereserve,\n    directlossibnrreserve,\n    cededlosspaid,\n    cededcasereserve,\n    0 as cededlossibnrreserve,\n    directpaiddcc,\n    directpaidao,\n    directlaecasreserve,\n    directlaeibnrreserve,\n    cededpaiddcc,\n    cededpaidao,\n    cededlaecasreserve,\n    cededlaeibnrreserve,\n    directcommissionsincurred,\n    cededcommissionsincurred,\n    account_entered_dt,\n    null as reinsurancecompany\nFROM (\n    SELECT\n        'PMS_Direct_Premiums' as source,\n        \"company desc\" AS companydesc,\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '017' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '617' THEN 'Commercial Umbrella (CUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END AS lobdesc,\n        s.gen4_desc AS riskstate,\n        annual_statement_line,\n        stateline,\n        SUM(written_premium) AS directwrittenpremium,\n        NULL AS cededwrittenpremium,\n        SUM(unearned_premium) AS directunearnedpremium,\n        NULL AS cededunearnedpremium,\n        NULL AS directlosspaid,\n        NULL AS directcasereserve,\n        SUM(unearned_premium * ref.ibnr_factor) AS directlossibnrreserve,\n        NULL AS cededlosspaid,\n        NULL AS cededcasereserve,\n        NULL AS directpaiddcc,\n        NULL AS directpaidao,\n        NULL AS directlaecasreserve,\n        SUM(unearned_premium * ref.ibnr_factor * ref.lae_ibnr_factor) AS directlaeibnrreserve,\n        NULL AS cededpaiddcc,\n        NULL AS cededpaidao,\n        0 AS cededlaecasreserve,\n        0 AS cededlaeibnrreserve,\n        SUM(commission_amount) AS directcommissionsincurred,\n        NULL AS cededcommissionsincurred,\n        \"account_entered_dt\" AS account_entered_dt\n    FROM\n        dbo.pms_fact_premiums_earned f\n    LEFT JOIN (\n        SELECT\n            \"policy_key\" AS \"master policy key\",\n            \"company_desc\" AS \"company desc\",\n            ISNULL(r.lob_display_desc, 'Not Applicable') AS \"lob desc\",\n            CONCAT(REPLICATE('0', 3 - LEN(\"module_number\")), \"module_number\") AS \"module number\",\n            i.fairplan_desc\n        FROM\n            \"dbo\".\"pms_master_policy\" i\n        LEFT JOIN\n            \"dbo\".\"lob_ref\" r  ON r.\"pms_lob_desc\" = i.\"lob_desc\"\n    ) p ON p.\"master policy key\" = f.\"policy_key\"\n    LEFT JOIN\n        \"dbo\".\"hier_dim_riskstate\" s  ON s.dim_id = f.\"risk_state_id\"\n    LEFT JOIN\n        dbo.profitloss_factors_ref ref  ON ref.state_line_code = f.stateline AND ref.year = CASE\n            WHEN date_part(year,\"account_entered_dt\") <= 2019 THEN 2019\n            ELSE date_part(year,\"account_entered_dt\")\n        END\n    LEFT JOIN\n        \"dbo\".\"hier_dim_majorperil\" m  ON m.dim_id = f.major_peril_id\n    WHERE\n        date_part(year,\"account_entered_dt\") >= 2005\n        AND m.dim_key NOT IN ('088', '089')\n        AND f.stateline IS NOT NULL\n        AND UPPER(LTRIM(RTRIM(p.fairplan_desc))) = 'NO'\n    GROUP BY\n        \"company desc\",\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '017' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '617' THEN 'Commercial Umbrella (CUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END,\n        \"account_entered_dt\",\n        s.gen4_desc,\n        annual_statement_line,\n        stateline\n    UNION\n    SELECT\n        'PMS_Direct_Premiums' AS source,\n        companydesc,\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END AS lobdesc,\n        riskstate,\n        annual_statement_line,\n        stateline,\n        NULL AS directwrittenpremium,\n        NULL AS cededwrittenpremium,\n        NULL AS directunearnedpremium,\n        NULL AS cededunearnedpremium,\n        NULL AS directlosspaid,\n        NULL AS directcasereserve,\n        NULL AS directlossibnrreserve,\n        NULL AS cededlosspaid,\n        NULL AS cededcasereserve,\n        NULL AS directpaiddcc,\n        NULL AS directpaidao,\n        NULL AS directlaecasreserve,\n        NULL AS directlaeibnrreserve,\n        NULL AS cededpaiddcc,\n        NULL AS cededpaidao,\n        0 AS cededlaecasreserve,\n        NULL AS cededlaeibnrreserve,\n        SUM(directcommissionsincurred),\n        NULL AS cededcommissionsincurred,\n        account_entered_dt\n    FROM (\n        SELECT\n            company AS companydesc,\n            risk_state AS riskstate,\n            CASE\n                WHEN lob = 'Dwelling' THEN '010'\n                WHEN lob = 'Homeowners' THEN '040'\n                WHEN lob = 'Businessowners' THEN '051'\n                ELSE 'null'\n            END AS annual_statement_line,\n            CASE\n                WHEN lob = 'Dwelling' THEN '1'\n                WHEN lob = 'Homeowners' THEN '4'\n                WHEN lob = 'Businessowners' THEN '8'\n                ELSE 'null'\n            END AS stateline,\n            commission_amount AS directcommissionsincurred,\n            \"account_entered_dt\" AS account_entered_dt\n        FROM (\n            SELECT\n                agency_code,\n                lob,\n                risk_state,\n                company,\n                account_entered_dt,\n                commission_amount\n            FROM\n                \"dbo\".\"production_incentives\" i\n            LEFT JOIN\n                dbo.view_master_agency a  ON a.\"agency code\" = i.agency_code\n            WHERE\n                ISNULL(a.\"field representative\", '') != 'Jim Ford'\n        ) a\n    ) b\n    GROUP BY\n        companydesc,\n        riskstate,\n        annual_statement_line,\n        stateline,\n        \"account_entered_dt\",\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END\n    UNION\n    SELECT\n        'PMS_Direct_Losses' AS source,\n        \"company desc\" AS companydesc,\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '017' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '617' THEN 'Commercial Umbrella (CUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END AS lobdesc,\n        s.gen4_desc AS riskstate,\n        annual_statement_line,\n        stateline,\n        NULL AS directwrittenpremium,\n        NULL AS cededwrittenpremium,\n        NULL AS directunearnedpremium,\n        NULL AS cededunearnedpremium,\n        SUM(ISNULL(loss_paid_amt, 0) + ISNULL(loss_paid_recovery_amt, 0) + ISNULL(loss_salvage, 0) + ISNULL(loss_subrogation_amt, 0)) AS directlosspaid,\n        NULL AS directcasereserve,\n        NULL AS directlossibnrreserve,\n        NULL AS cededlosspaid,\n        NULL AS cededcasereserve,\n        SUM(\"loss_alae_expense\") AS directpaiddcc,\n        SUM(\"loss_ulae_expense\") AS directpaidao,\n        NULL AS directlaecasreserve,\n        NULL AS directlaeibnrreserve,\n        NULL AS cededpaiddcc,\n        NULL AS cededpaidao,\n        0 AS cededlaecasreserve,\n        0 AS cededlaeibnrreserve,\n        NULL AS directcommissionsincurred,\n        NULL AS cededcommissionsincurred,\n        \"account_entered_dt\" AS account_entered_dt\n    FROM\n        \"dbo\".\"pms_fact_loss\" f\n    LEFT JOIN (\n        SELECT\n            \"policy_key\" AS \"master policy key\",\n            \"company_desc\" AS \"company desc\",\n            ISNULL(r.lob_display_desc, 'Not Applicable') AS \"lob desc\",\n            CONCAT(REPLICATE('0', 3 - LEN(\"module_number\")), \"module_number\") AS \"module number\",\n            i.fairplan_desc\n        FROM\n            \"dbo\".\"pms_master_policy\" i\n        LEFT JOIN\n            \"dbo\".\"lob_ref\" r  ON r.\"pms_lob_desc\" = i.\"lob_desc\"\n    ) p ON p.\"master policy key\" = f.\"policy_key\"\n    LEFT JOIN\n        \"dbo\".\"hier_dim_riskstate\" s  ON s.dim_id = f.\"risk_state_id\"\n    LEFT JOIN\n        dbo.profitloss_factors_ref ref  ON ref.state_line_code = f.stateline AND ref.year = CASE\n            WHEN date_part(year,\"account_entered_dt\") <= 2019 THEN 2019\n            ELSE date_part(year,\"account_entered_dt\")\n        END\n    LEFT JOIN\n        \"dbo\".\"hier_dim_majorperil\" m  ON m.dim_id = f.major_peril_id\n    WHERE\n        date_part(year,\"account_entered_dt\") >= 2005\n        AND m.dim_key NOT IN ('088', '089')\n        AND f.stateline IS NOT NULL\n        AND UPPER(LTRIM(RTRIM(p.fairplan_desc))) = 'NO'\n    GROUP BY\n        \"company desc\",\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '017' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '617' THEN 'Commercial Umbrella (CUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END,\n        \"account_entered_dt\",\n        s.gen4_desc,\n        annual_statement_line,\n        stateline\n    UNION\n    SELECT\n        'PMS_Direct_Losses' AS source,\n        \"company desc\" AS companydesc,\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '017' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '617' THEN 'Commercial Umbrella (CUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END AS lobdesc,\n        s.gen4_desc AS riskstate,\n        annual_statement_line,\n        stateline,\n        NULL AS directwrittenpremium,\n        NULL AS cededwrittenpremium,\n        NULL AS directunearnedpremium,\n        NULL AS cededunearnedpremium,\n        NULL AS directlosspaid,\n        SUM(loss_end_reserve_amt) AS directcasereserve,\n        NULL AS directlossibnrreserve,\n        NULL AS cededlosspaid,\n        NULL AS cededcasereserve,\n        SUM(\"loss_alae_expense\") AS directpaiddcc,\n        SUM(\"loss_ulae_expense\") AS directpaidao,\n        SUM(loss_end_reserve_amt * ref.lae_case_factor) AS directlaecasreserve,\n        NULL AS directlaeibnrreserve,\n        NULL AS cededpaiddcc,\n        NULL AS cededpaidao,\n        0 AS cededlaecasreserve,\n        0 AS cededlaeibnrreserve,\n        NULL AS directcommissionsincurred,\n        NULL AS cededcommissionsincurred,\n        \"account_entered_dt\" AS account_entered_dt\n    FROM\n        \"dbo\".\"pms_fact_loss_reserves\" f\n    LEFT JOIN (\n        SELECT\n            \"policy_key\" AS \"master policy key\",\n            \"company_desc\" AS \"company desc\",\n            ISNULL(r.lob_display_desc, 'Not Applicable') AS \"lob desc\",\n            CONCAT(REPLICATE('0', 3 - LEN(\"module_number\")), \"module_number\") AS \"module number\",\n            i.fairplan_desc\n        FROM\n            \"dbo\".\"pms_master_policy\" i\n        LEFT JOIN\n            \"dbo\".\"lob_ref\" r  ON r.\"pms_lob_desc\" = i.\"lob_desc\"\n    ) p ON p.\"master policy key\" = f.\"policy_key\"\n    LEFT JOIN\n        \"dbo\".\"hier_dim_riskstate\" s  ON s.dim_id = f.\"risk_state_id\"\n    LEFT JOIN\n        dbo.profitloss_factors_ref ref  ON ref.state_line_code = f.stateline AND ref.year = CASE\n            WHEN date_part(year,\"account_entered_dt\") <= 2019 THEN 2019\n            ELSE date_part(year,\"account_entered_dt\")\n        END\n    LEFT JOIN\n        \"dbo\".\"hier_dim_majorperil\" m  ON m.dim_id = f.major_peril_id\n    WHERE\n        date_part(year,\"account_entered_dt\") >= 2005\n        AND m.dim_key NOT IN ('088', '089')\n        AND f.stateline IS NOT NULL\n        AND UPPER(LTRIM(RTRIM(p.fairplan_desc))) = 'NO'\n    GROUP BY\n        \"company desc\",\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '017' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '617' THEN 'Commercial Umbrella (CUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END,\n        \"account_entered_dt\",\n        s.gen4_desc,\n        annual_statement_line,\n        stateline\n) a\nORDER BY\n    a.account_entered_dt\n\n\n"
      },
      "oprRuntimeAttrs" : {
        "sqlQuery" : "SELECT\n    source,\n    companydesc,\n    lobdesc,\n    riskstate,\n    a.annual_statement_line,\n    stateline,\n    directwrittenpremium,\n    cededwrittenpremium,\n    directunearnedpremium,\n    cededunearnedpremium,\n    directlosspaid,\n    directcasereserve,\n    directlossibnrreserve,\n    cededlosspaid,\n    cededcasereserve,\n    0 as cededlossibnrreserve,\n    directpaiddcc,\n    directpaidao,\n    directlaecasreserve,\n    directlaeibnrreserve,\n    cededpaiddcc,\n    cededpaidao,\n    cededlaecasreserve,\n    cededlaeibnrreserve,\n    directcommissionsincurred,\n    cededcommissionsincurred,\n    account_entered_dt,\n    null as reinsurancecompany\nFROM (\n    SELECT\n        'PMS_Direct_Premiums' as source,\n        \"company desc\" AS companydesc,\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '017' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '617' THEN 'Commercial Umbrella (CUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END AS lobdesc,\n        s.gen4_desc AS riskstate,\n        annual_statement_line,\n        stateline,\n        SUM(written_premium) AS directwrittenpremium,\n        NULL AS cededwrittenpremium,\n        SUM(unearned_premium) AS directunearnedpremium,\n        NULL AS cededunearnedpremium,\n        NULL AS directlosspaid,\n        NULL AS directcasereserve,\n        SUM(unearned_premium * ref.ibnr_factor) AS directlossibnrreserve,\n        NULL AS cededlosspaid,\n        NULL AS cededcasereserve,\n        NULL AS directpaiddcc,\n        NULL AS directpaidao,\n        NULL AS directlaecasreserve,\n        SUM(unearned_premium * ref.ibnr_factor * ref.lae_ibnr_factor) AS directlaeibnrreserve,\n        NULL AS cededpaiddcc,\n        NULL AS cededpaidao,\n        0 AS cededlaecasreserve,\n        0 AS cededlaeibnrreserve,\n        SUM(commission_amount) AS directcommissionsincurred,\n        NULL AS cededcommissionsincurred,\n        \"account_entered_dt\" AS account_entered_dt\n    FROM\n        dbo.pms_fact_premiums_earned f\n    LEFT JOIN (\n        SELECT\n            \"policy_key\" AS \"master policy key\",\n            \"company_desc\" AS \"company desc\",\n            ISNULL(r.lob_display_desc, 'Not Applicable') AS \"lob desc\",\n            CONCAT(REPLICATE('0', 3 - LEN(\"module_number\")), \"module_number\") AS \"module number\",\n            i.fairplan_desc\n        FROM\n            \"dbo\".\"pms_master_policy\" i\n        LEFT JOIN\n            \"dbo\".\"lob_ref\" r  ON r.\"pms_lob_desc\" = i.\"lob_desc\"\n    ) p ON p.\"master policy key\" = f.\"policy_key\"\n    LEFT JOIN\n        \"dbo\".\"hier_dim_riskstate\" s  ON s.dim_id = f.\"risk_state_id\"\n    LEFT JOIN\n        dbo.profitloss_factors_ref ref  ON ref.state_line_code = f.stateline AND ref.year = CASE\n            WHEN date_part(year,\"account_entered_dt\") <= 2019 THEN 2019\n            ELSE date_part(year,\"account_entered_dt\")\n        END\n    LEFT JOIN\n        \"dbo\".\"hier_dim_majorperil\" m  ON m.dim_id = f.major_peril_id\n    WHERE\n        date_part(year,\"account_entered_dt\") >= 2005\n        AND m.dim_key NOT IN ('088', '089')\n        AND f.stateline IS NOT NULL\n        AND UPPER(LTRIM(RTRIM(p.fairplan_desc))) = 'NO'\n    GROUP BY\n        \"company desc\",\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '017' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '617' THEN 'Commercial Umbrella (CUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END,\n        \"account_entered_dt\",\n        s.gen4_desc,\n        annual_statement_line,\n        stateline\n    UNION\n    SELECT\n        'PMS_Direct_Premiums' AS source,\n        companydesc,\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END AS lobdesc,\n        riskstate,\n        annual_statement_line,\n        stateline,\n        NULL AS directwrittenpremium,\n        NULL AS cededwrittenpremium,\n        NULL AS directunearnedpremium,\n        NULL AS cededunearnedpremium,\n        NULL AS directlosspaid,\n        NULL AS directcasereserve,\n        NULL AS directlossibnrreserve,\n        NULL AS cededlosspaid,\n        NULL AS cededcasereserve,\n        NULL AS directpaiddcc,\n        NULL AS directpaidao,\n        NULL AS directlaecasreserve,\n        NULL AS directlaeibnrreserve,\n        NULL AS cededpaiddcc,\n        NULL AS cededpaidao,\n        0 AS cededlaecasreserve,\n        NULL AS cededlaeibnrreserve,\n        SUM(directcommissionsincurred),\n        NULL AS cededcommissionsincurred,\n        account_entered_dt\n    FROM (\n        SELECT\n            company AS companydesc,\n            risk_state AS riskstate,\n            CASE\n                WHEN lob = 'Dwelling' THEN '010'\n                WHEN lob = 'Homeowners' THEN '040'\n                WHEN lob = 'Businessowners' THEN '051'\n                ELSE 'null'\n            END AS annual_statement_line,\n            CASE\n                WHEN lob = 'Dwelling' THEN '1'\n                WHEN lob = 'Homeowners' THEN '4'\n                WHEN lob = 'Businessowners' THEN '8'\n                ELSE 'null'\n            END AS stateline,\n            commission_amount AS directcommissionsincurred,\n            \"account_entered_dt\" AS account_entered_dt\n        FROM (\n            SELECT\n                agency_code,\n                lob,\n                risk_state,\n                company,\n                account_entered_dt,\n                commission_amount\n            FROM\n                \"dbo\".\"production_incentives\" i\n            LEFT JOIN\n                dbo.view_master_agency a  ON a.\"agency code\" = i.agency_code\n            WHERE\n                ISNULL(a.\"field representative\", '') != 'Jim Ford'\n        ) a\n    ) b\n    GROUP BY\n        companydesc,\n        riskstate,\n        annual_statement_line,\n        stateline,\n        \"account_entered_dt\",\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END\n    UNION\n    SELECT\n        'PMS_Direct_Losses' AS source,\n        \"company desc\" AS companydesc,\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '017' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '617' THEN 'Commercial Umbrella (CUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END AS lobdesc,\n        s.gen4_desc AS riskstate,\n        annual_statement_line,\n        stateline,\n        NULL AS directwrittenpremium,\n        NULL AS cededwrittenpremium,\n        NULL AS directunearnedpremium,\n        NULL AS cededunearnedpremium,\n        SUM(ISNULL(loss_paid_amt, 0) + ISNULL(loss_paid_recovery_amt, 0) + ISNULL(loss_salvage, 0) + ISNULL(loss_subrogation_amt, 0)) AS directlosspaid,\n        NULL AS directcasereserve,\n        NULL AS directlossibnrreserve,\n        NULL AS cededlosspaid,\n        NULL AS cededcasereserve,\n        SUM(\"loss_alae_expense\") AS directpaiddcc,\n        SUM(\"loss_ulae_expense\") AS directpaidao,\n        NULL AS directlaecasreserve,\n        NULL AS directlaeibnrreserve,\n        NULL AS cededpaiddcc,\n        NULL AS cededpaidao,\n        0 AS cededlaecasreserve,\n        0 AS cededlaeibnrreserve,\n        NULL AS directcommissionsincurred,\n        NULL AS cededcommissionsincurred,\n        \"account_entered_dt\" AS account_entered_dt\n    FROM\n        \"dbo\".\"pms_fact_loss\" f\n    LEFT JOIN (\n        SELECT\n            \"policy_key\" AS \"master policy key\",\n            \"company_desc\" AS \"company desc\",\n            ISNULL(r.lob_display_desc, 'Not Applicable') AS \"lob desc\",\n            CONCAT(REPLICATE('0', 3 - LEN(\"module_number\")), \"module_number\") AS \"module number\",\n            i.fairplan_desc\n        FROM\n            \"dbo\".\"pms_master_policy\" i\n        LEFT JOIN\n            \"dbo\".\"lob_ref\" r  ON r.\"pms_lob_desc\" = i.\"lob_desc\"\n    ) p ON p.\"master policy key\" = f.\"policy_key\"\n    LEFT JOIN\n        \"dbo\".\"hier_dim_riskstate\" s  ON s.dim_id = f.\"risk_state_id\"\n    LEFT JOIN\n        dbo.profitloss_factors_ref ref  ON ref.state_line_code = f.stateline AND ref.year = CASE\n            WHEN date_part(year,\"account_entered_dt\") <= 2019 THEN 2019\n            ELSE date_part(year,\"account_entered_dt\")\n        END\n    LEFT JOIN\n        \"dbo\".\"hier_dim_majorperil\" m  ON m.dim_id = f.major_peril_id\n    WHERE\n        date_part(year,\"account_entered_dt\") >= 2005\n        AND m.dim_key NOT IN ('088', '089')\n        AND f.stateline IS NOT NULL\n        AND UPPER(LTRIM(RTRIM(p.fairplan_desc))) = 'NO'\n    GROUP BY\n        \"company desc\",\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '017' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '617' THEN 'Commercial Umbrella (CUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END,\n        \"account_entered_dt\",\n        s.gen4_desc,\n        annual_statement_line,\n        stateline\n    UNION\n    SELECT\n        'PMS_Direct_Losses' AS source,\n        \"company desc\" AS companydesc,\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '017' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '617' THEN 'Commercial Umbrella (CUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END AS lobdesc,\n        s.gen4_desc AS riskstate,\n        annual_statement_line,\n        stateline,\n        NULL AS directwrittenpremium,\n        NULL AS cededwrittenpremium,\n        NULL AS directunearnedpremium,\n        NULL AS cededunearnedpremium,\n        NULL AS directlosspaid,\n        SUM(loss_end_reserve_amt) AS directcasereserve,\n        NULL AS directlossibnrreserve,\n        NULL AS cededlosspaid,\n        NULL AS cededcasereserve,\n        SUM(\"loss_alae_expense\") AS directpaiddcc,\n        SUM(\"loss_ulae_expense\") AS directpaidao,\n        SUM(loss_end_reserve_amt * ref.lae_case_factor) AS directlaecasreserve,\n        NULL AS directlaeibnrreserve,\n        NULL AS cededpaiddcc,\n        NULL AS cededpaidao,\n        0 AS cededlaecasreserve,\n        0 AS cededlaeibnrreserve,\n        NULL AS directcommissionsincurred,\n        NULL AS cededcommissionsincurred,\n        \"account_entered_dt\" AS account_entered_dt\n    FROM\n        \"dbo\".\"pms_fact_loss_reserves\" f\n    LEFT JOIN (\n        SELECT\n            \"policy_key\" AS \"master policy key\",\n            \"company_desc\" AS \"company desc\",\n            ISNULL(r.lob_display_desc, 'Not Applicable') AS \"lob desc\",\n            CONCAT(REPLICATE('0', 3 - LEN(\"module_number\")), \"module_number\") AS \"module number\",\n            i.fairplan_desc\n        FROM\n            \"dbo\".\"pms_master_policy\" i\n        LEFT JOIN\n            \"dbo\".\"lob_ref\" r  ON r.\"pms_lob_desc\" = i.\"lob_desc\"\n    ) p ON p.\"master policy key\" = f.\"policy_key\"\n    LEFT JOIN\n        \"dbo\".\"hier_dim_riskstate\" s  ON s.dim_id = f.\"risk_state_id\"\n    LEFT JOIN\n        dbo.profitloss_factors_ref ref  ON ref.state_line_code = f.stateline AND ref.year = CASE\n            WHEN date_part(year,\"account_entered_dt\") <= 2019 THEN 2019\n            ELSE date_part(year,\"account_entered_dt\")\n        END\n    LEFT JOIN\n        \"dbo\".\"hier_dim_majorperil\" m  ON m.dim_id = f.major_peril_id\n    WHERE\n        date_part(year,\"account_entered_dt\") >= 2005\n        AND m.dim_key NOT IN ('088', '089')\n        AND f.stateline IS NOT NULL\n        AND UPPER(LTRIM(RTRIM(p.fairplan_desc))) = 'NO'\n    GROUP BY\n        \"company desc\",\n        CASE\n            WHEN stateline = '1' THEN 'Fire'\n            WHEN stateline = '2' THEN 'Extended Coverage (EC)'\n            WHEN stateline IN ('A', '4', '6', '7') THEN 'Homeowner (HO)'\n            WHEN stateline = '9' THEN 'Inland Marine (IM)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '017' THEN 'Personal Umbrella (PUMB)'\n            WHEN stateline = 'X' AND LTRIM(RTRIM(m.\"dim_key\")) LIKE '617' THEN 'Commercial Umbrella (CUMB)'\n            WHEN stateline IN ('8', 'D', 'C') THEN 'Business Owners Policy (BOP)'\n            WHEN stateline IN ('E', '5') THEN 'Commercial Multi Peril (CMP)'\n            WHEN stateline = 'Y' THEN 'Dwelling Liability'\n        END,\n        \"account_entered_dt\",\n        s.gen4_desc,\n        annual_statement_line,\n        stateline\n) a\nORDER BY\n    a.account_entered_dt\n\n\n",
        "preSql" : "truncate table dbo.profitloss_monthly_base; \ntruncate table  dbo.profitloss_monthly_feed;"
      },
      "commandType" : 0,
      "handleSpecialChars" : false,
      "handleDecimalRoundOff" : false,
      "frsAsset" : false,
      "dynamicFileName" : false,
      "excludeDynamicFileNameField" : false,
      "currentlyProcessedFileName" : false,
      "retainFieldMetadata" : false,
      "useExactSrcNames" : false,
      "userUpdated" : true,
      "fetchMode" : "ORIGINAL",
      "runtimeParameterData" : {
        "connectionParameterName" : "DBConnection_Src",
        "connectionRuntimeParameter" : true,
        "objectRuntimeParameter" : false
      },
      "restmodernSource" : true,
      "unspecified" : false,
      "fileList" : false
    },
    {
      "name" : "$ProfitLoss_Monthly_Base1$",
      "type" : "TARGET",
      "label" : "DBConnection_Tgt",
      "uiProperties" : {
        "cnxtype" : "Amazon Redshift v2",
        "connectionParameterized" : "true",
        "paramName" : "DBConnection_Tgt",
        "paramType-mapping" : "Connection",
        "logcnx" : "DBConnection_Tgt",
        "default" : "dbo/profitloss_monthly_base",
        "objectParameterized" : "false",
        "visible" : "false",
        "supportApplyDDLChanges" : "false",
        "originalPath" : "ProfitLoss_Monthly_Base1"
      },
      "targetConnectionId" : "@6Uao049gWFIeOw6WPSkjsu",
      "connectionName" : "redshift_nonprod_andover_dw_dev",
      "targetObject" : "dbo/profitloss_monthly_base",
      "targetObjectLabel" : "profitloss_monthly_base",
      "newFlatFile" : false,
      "newObject" : false,
      "showBusinessNames" : true,
      "naturalOrder" : true,
      "truncateTarget" : false,
      "bulkApiDBTarget" : false,
      "operationType" : "Insert",
      "customFuncCfg" : { },
      "extendedObject" : {
        "singleMode" : true
      },
      "commandType" : 0,
      "handleSpecialChars" : false,
      "handleDecimalRoundOff" : false,
      "frsAsset" : false,
      "dynamicFileName" : false,
      "excludeDynamicFileNameField" : false,
      "currentlyProcessedFileName" : false,
      "retainFieldMetadata" : false,
      "objectName" : "dbo/profitloss_monthly_base",
      "objectLabel" : "profitloss_monthly_base",
      "useExactSrcNames" : false,
      "userUpdated" : true,
      "fetchMode" : "ORIGINAL",
      "runtimeParameterData" : {
        "connectionParameterName" : "DBConnection_Tgt",
        "connectionRuntimeParameter" : true,
        "objectRuntimeParameter" : false
      },
      "targetSchemaProviderType" : "SELECTED_OBJECT",
      "restmodernSource" : true,
      "unspecified" : false,
      "fileList" : false
    }
  ],
  "verbose" : false,
  "mappingId" : "@9aOzZXfADg9ecqbxSVaA65",
  "mappingTemplateName" : "m_PL_Feed_Summations",
  "sessionPropertiesList" : [
    {
      "name" : "Allow Temporary Sequence for Pushdown",
      "value" : "NO"
    },
    {
      "name" : "Allow Temporary View for Pushdown",
      "value" : "NO"
    },
    {
      "name" : "Data Column Delimiter",
      "value" : "|"
    },
    {
      "name" : "DateTime Format String",
      "value" : "MM/DD/YYYY HH24:MI:SS.US"
    },
    {
      "name" : "Error Log File Name",
      "value" : "PMError.log"
    },
    {
      "name" : "Pushdown Optimization",
      "value" : "None"
    },
    {
      "name" : "Pushdown Optimization Context",
      "value" : "None"
    },
    {
      "name" : "Pushdown Optimization Fallback Option",
      "value" : "Partial PDO"
    }
  ],
  "hidden" : false,
  "enableCrossSchemaPushdown" : false,
  "enableParallelRun" : false,
  "autoTunedApplied" : false,
  "autoTunedAppliedType" : "NONE",
  "parameterFileName" : "Andover_Parm_Feed.txt",
  "parameterFileDir" : "$PMRootDir/andover/parameters",
  "paramFileType" : "PARAM_FILE_LOCAL",
  "schemaMode" : "async",
  "valid" : true,
  "optimizationPlan" : "NONE",
  "allowMaxFieldLength" : false,
  "specialCharacterSupport" : false,
  "midstreamPreview" : false,
  "vcsExportTime" : "2026-01-19 09:45:00 PST"
}